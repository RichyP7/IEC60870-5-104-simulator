<p-toast></p-toast>
<div class="card">

  <p-accordion>
    <p-accordion-panel *ngFor="let tab of groupedData; let i = index" [value]="i"
    >
      <p-accordion-header>
        Stationary Address: {{ tab.stationaryAddress }}
        <span class="item-count">({{ tab.items.length }})</span>
      </p-accordion-header>
      <p-accordion-content *ngFor="let item of tab.items" >
        <div
          [ngClass]="{'selected-item': item.objectAddress === selectedItem?.objectAddress && item.stationaryAddress === selectedItem?.stationaryAddress}"
          class="item-row p-2 border-round cursor-pointer"
          (click)="clickOnDataPoint(item)"
        >
          <div class="item-header">
            <span class="item-id">{{ item.id }}</span>
            <span class="item-badge mode-badge">{{ modeLabel(item.mode) }}</span>
          </div>
          <div class="item-meta">
            <span class="meta-tag">OA: {{ item.objectAddress }}</span>
            <span class="meta-tag">{{ item.iec104DataType }}</span>
            <span class="meta-tag value-tag">{{ displayValue(item) }}</span>
          </div>
        </div>
      </p-accordion-content>
    </p-accordion-panel>
  </p-accordion>
</div>
<div class="card accordion-container">
  <p-button label="Reload" icon="pi pi-refresh" (onClick)="reloadData()" severity="secondary" />
  <p-button label="Create DataPoint" icon="pi pi-plus" (click)="showDialog = true" />
</div>
<app-create-dialog
  [visible]="showDialog"
  (visibleChange)="processDialogChange($event)"
  (dataPointCreated)="createDataPoint($event)"
></app-create-dialog>
