<p-toast></p-toast>
<div class="details-card" *ngIf="item != null">
  <p-card header="Datapoint Details">
    <div class="grid details-grid">
      <div class="grid-item label">ID:</div>
      <div class="grid-item value">{{ item.id }}</div>

      <div class="grid-item label">Stationary Address:</div>
      <div class="grid-item value">{{ item.stationaryAddress }}</div>

      <div class="grid-item label">Object Address:</div>
      <div class="grid-item value">{{ item.objectAddress }}</div>

      <div class="grid-item label">IEC104 Data Type:</div>
      <div class="grid-item value">
        {{ item.iec104DataType }}
        <a href="https://infosys.beckhoff.com/english.php?content=../content/1033/tf6500_tc3_iec60870_5_10x/984447883.html&id=" target="_blank" class="text-primary-emphasis text-xl">
          <i class="pi pi-info-circle"></i>
        </a>
      </div>

      <div class="grid-item label">Simulation Mode:</div>
      <div class="grid-item value flex align-items-center">
        <p-dropdown [options]="simulationModes" [(ngModel)]="item.mode" optionLabel="label" optionValue="value"
          (onChange)="toggleSimulationMode(item)">
          <ng-template let-option pTemplate="selectedItem">
            <div class="dropdown-item">
              <span>{{ option.label }}</span>
              <i *ngIf="option.icon" [class]="option.icon"></i>
            </div>
          </ng-template>
          <ng-template let-option pTemplate="item">
            <div class="dropdown-item flex align-items-center">
              <span>{{ option.label }}</span>
              <i *ngIf="option.icon" [class]="option.icon"></i>
            </div>
          </ng-template>
        </p-dropdown>
      </div>

      <div class="grid-item label" *ngIf="isPredefinedProfile">Profile:</div>
      <div class="grid-item value flex align-items-center" *ngIf="isPredefinedProfile">
        <p-select [options]="availableProfiles" [(ngModel)]="item.profileName"
          (onChange)="onProfileNameChange(item)" placeholder="Select a profile"></p-select>
      </div>

      <div class="grid-item label">Value:</div>
      <div class="grid-item value flex align-items-center gap-2">
        <!-- Read-only display -->
        <ng-container *ngIf="!isEditing">
          <span class="value-display" [class.auto-mode]="isAutoMode">{{ displayValue() }}</span>
          <span *ngIf="isAutoMode" class="auto-hint">(auto)</span>
          <p-button
            *ngIf="!isAutoMode"
            icon="pi pi-pen-to-square"
            [text]="true"
            size="small"
            (onClick)="startEditing()"
          ></p-button>
        </ng-container>

        <!-- Editing: Single Point (boolean toggle) -->
        <ng-container *ngIf="isEditing && valueType === 'singlePoint'">
          <p-toggleSwitch [(ngModel)]="editValue"></p-toggleSwitch>
          <span class="ml-1">{{ editValue ? 'ON' : 'OFF' }}</span>
        </ng-container>

        <!-- Editing: Double Point (dropdown) -->
        <ng-container *ngIf="isEditing && valueType === 'doublePoint'">
          <p-select [options]="doublePointOptions" [(ngModel)]="editValue"
            optionLabel="label" optionValue="value"></p-select>
        </ng-container>

        <!-- Editing: Float -->
        <ng-container *ngIf="isEditing && valueType === 'float'">
          <p-inputNumber [(ngModel)]="editValue" mode="decimal" [minFractionDigits]="1" [maxFractionDigits]="4"></p-inputNumber>
        </ng-container>

        <!-- Editing: Scaled / Numeric -->
        <ng-container *ngIf="isEditing && (valueType === 'scaled' || valueType === 'numeric')">
          <p-inputNumber [(ngModel)]="editValue"></p-inputNumber>
        </ng-container>

        <!-- Edit action buttons -->
        <ng-container *ngIf="isEditing">
          <p-button
            icon="pi pi-check"
            severity="success"
            [text]="true"
            size="small"
            (onClick)="saveValue()"
          ></p-button>
          <p-button
            icon="pi pi-times"
            severity="danger"
            [text]="true"
            size="small"
            (onClick)="cancelEditing()"
          ></p-button>
        </ng-container>
      </div>
    </div>
  </p-card>
</div>
